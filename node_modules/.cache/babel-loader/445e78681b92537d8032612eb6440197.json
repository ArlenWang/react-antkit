{"ast":null,"code":"import \"antd-mobile/lib/toast/style/css\";\nimport _Toast from \"antd-mobile/lib/toast\";\nimport \"antd-mobile/lib/activity-indicator/style/css\";\nimport _ActivityIndicator from \"antd-mobile/lib/activity-indicator\";\nvar _jsxFileName = \"/Users/mljfnn/Desktop/demos/react/antkit/src/views/SearchResult.jsx\";\nimport React from 'react';\nimport TabsTop from '../components/TabsTop.jsx';\nimport DropMenu from '../components/DropMenu.jsx';\nimport TwoItem from '../components/TwoItem.jsx';\nimport ThreeItem from '../components/ThreeItem.jsx';\nimport FourItem from '../components/FourItem.jsx';\nimport DetailTop from '../components/DetailTop';\nimport BackBar from '../components/BackBar';\nimport ReactDOM from 'react-dom';\nimport { api } from '../config/Api';\nimport { get } from '../utils/NetWorking';\nimport { getsearch } from '../utils/Help';\n\nconst EmptyList = () => React.createElement(\"div\", {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 14\n  },\n  __self: this\n}, React.createElement(TwoItem, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 14\n  },\n  __self: this\n}), React.createElement(ThreeItem, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 14\n  },\n  __self: this\n}), React.createElement(FourItem, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 14\n  },\n  __self: this\n}));\n\nconst tabTypeID = [3, 6, 4];\nconst dropTypeID = [0, 2, 3, 4];\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.rowData = data => {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94\n        },\n        __self: this\n      }, this.state.loading ? React.createElement(\"div\", {\n        style: {\n          width: \"28vw\",\n          margin: \"auto\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      }, React.createElement(_ActivityIndicator, {\n        text: \"\\u6B63\\u5728\\u52A0\\u8F7D...\",\n        color: \"white\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95\n        },\n        __self: this\n      })) : null, data.map((item, index) => {\n        switch (item.goods_list.length) {\n          case 2:\n            return React.createElement(TwoItem, {\n              itemData: item,\n              key: index,\n              fixMain: true,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 99\n              },\n              __self: this\n            });\n          //break;\n\n          case 3:\n            return React.createElement(ThreeItem, {\n              itemData: item,\n              key: index,\n              fixMain: true,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 102\n              },\n              __self: this\n            });\n          //break;\n\n          case 4:\n            return React.createElement(FourItem, {\n              itemData: item,\n              key: index,\n              fixMain: true,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 105\n              },\n              __self: this\n            });\n          //break;\n\n          default:\n            return React.createElement(\"div\", {\n              key: index,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 108\n              },\n              __self: this\n            }, \"erro\");\n        }\n      }));\n    };\n\n    this.tabClick = index => {\n      if (index !== this.state.tabActive) {\n        this.setState({\n          tabActive: index\n        });\n        this.netListdata(tabTypeID[index]);\n      }\n    };\n\n    this.dropFun = index => {\n      if (index !== this.state.dropActive) {\n        this.setState({\n          dropActive: index\n        });\n        this.netListdata(null, dropTypeID[index]);\n      }\n    };\n\n    this.onScrollEvent = () => {\n      this.scollNum++;\n      let thisNum = parseInt(this.scollNum, 10);\n\n      if (!this.state.isAlpha && !this.changeAlpha && !this.lock) {\n        this.setState({\n          isAlpha: true\n        });\n        this.changeAlpha = true;\n      }\n\n      setTimeout(() => {\n        this.changeAlpha = false;\n      }, 300);\n      setTimeout(() => {\n        if (thisNum === this.scollNum) {\n          if (this.state.isAlpha) this.setState({\n            isAlpha: false\n          });\n        }\n      }, 500);\n    };\n\n    let searchA = getsearch(this.props.location);\n    this.scollNum = 0;\n    this.state = {\n      menuTop: 338,\n      isAlpha: false,\n      dataSource: [],\n      tabActive: searchA['cid'] ? this.getTabIndex(searchA['cid']) : 0,\n      dropActive: searchA['num'] ? this.getDropIndex(searchA['num']) : 0,\n      loading: false\n    };\n    this.changeAlpha = false;\n    this.lock = false;\n    this.loading = false;\n    console.log(this.state);\n  }\n\n  getTabIndex(cid) {\n    cid = parseInt(cid, 10);\n\n    for (let index = 0; index < tabTypeID.length; index++) {\n      const element = tabTypeID[index];\n\n      if (element === cid) {\n        return index;\n      }\n    }\n\n    return 0;\n  }\n\n  getDropIndex(num) {\n    for (let index = 0; index < dropTypeID.length; index++) {\n      const element = dropTypeID[index];\n\n      if (element === num) {\n        return index;\n      }\n    }\n\n    return 0;\n  }\n\n  componentWillUnmount() {\n    this.lock = true;\n  }\n\n  componentDidMount() {\n    this.positionInit();\n    this.netListdata();\n  }\n\n  positionInit() {\n    let topV = ReactDOM.findDOMNode(this.rightBtn).offsetTop;\n    topV = topV + 58;\n    this.setState({\n      menuTop: topV\n    });\n  }\n\n  loadingEnd() {\n    this.loading = false;\n    if (!this.lock) this.setState({\n      loading: false\n    });\n  }\n\n  loadingStart() {\n    this.loading = true;\n    this.setState({\n      loading: true\n    });\n  }\n\n  netListdata(cid, num) {\n    /*\n    cid 3 美妆 4 日用品 6 美食 \n    num 0 全部 2\b 两个组合\n    */\n    let req = \"?cid=\" + (cid ? cid : tabTypeID[this.state.tabActive]) + \"&num=\" + (num ? num : dropTypeID[this.state.dropActive]);\n    let thisUrl = api.index_list + req;\n    if (this.loading) return;\n    this.loadingStart();\n    get(thisUrl, res => {\n      this.loadingEnd(); //console.log(res);\n\n      if (res && res['result'] === 'success') {\n        this.setState({\n          dataSource: res['data']\n        });\n      } else {\n        if (res && res['message']) _Toast.fail(res['message'], 1);\n      }\n    }, erro => {\n      this.loadingEnd();\n      console.log(erro);\n    });\n  }\n\n  render() {\n    const _this$props = this.props,\n          history = _this$props.history,\n          location = _this$props.location;\n    const pageProps = {\n      history,\n      location\n    };\n    return React.createElement(\"div\", {\n      className: \"App\",\n      onScrollCapture: () => this.onScrollEvent(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, React.createElement(BackBar, Object.assign({}, pageProps, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    })), React.createElement(DetailTop, Object.assign({}, pageProps, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    })), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }), React.createElement(TabsTop, Object.assign({\n      activeid: this.state.tabActive\n    }, pageProps, {\n      tabClick: this.tabClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148\n      },\n      __self: this\n    })), React.createElement(DropMenu, Object.assign({}, pageProps, {\n      fixTop: this.state.menuTop,\n      ref: leftB => {\n        this.rightBtn = leftB;\n      },\n      isAlpha: this.state.isAlpha,\n      dropActive: this.state.dropActive,\n      dropFun: this.dropFun,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    })), this.state.dataSource && this.state.dataSource.length > 0 ? this.rowData(this.state.dataSource) : React.createElement(EmptyList, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/mljfnn/Desktop/demos/react/antkit/src/views/SearchResult.jsx"],"names":["React","TabsTop","DropMenu","TwoItem","ThreeItem","FourItem","DetailTop","BackBar","ReactDOM","api","get","getsearch","EmptyList","tabTypeID","dropTypeID","App","Component","constructor","props","rowData","data","state","loading","width","margin","map","item","index","goods_list","length","tabClick","tabActive","setState","netListdata","dropFun","dropActive","onScrollEvent","scollNum","thisNum","parseInt","isAlpha","changeAlpha","lock","setTimeout","searchA","location","menuTop","dataSource","getTabIndex","getDropIndex","console","log","cid","element","num","componentWillUnmount","componentDidMount","positionInit","topV","findDOMNode","rightBtn","offsetTop","loadingEnd","loadingStart","req","thisUrl","index_list","res","fail","erro","render","history","pageProps","leftB"],"mappings":"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","sourcesContent":["import React from 'react';\nimport TabsTop from '../components/TabsTop.jsx';\nimport DropMenu from '../components/DropMenu.jsx';\nimport TwoItem from '../components/TwoItem.jsx';\nimport ThreeItem from '../components/ThreeItem.jsx';\nimport FourItem from '../components/FourItem.jsx';\nimport DetailTop from '../components/DetailTop';\nimport BackBar from '../components/BackBar';\nimport ReactDOM from 'react-dom';\nimport { api } from '../config/Api';\nimport { get } from '../utils/NetWorking';\nimport { Toast,ActivityIndicator } from 'antd-mobile';\nimport { getsearch } from '../utils/Help';\nconst EmptyList=()=>(<div><TwoItem/><ThreeItem/><FourItem/></div>)\nconst tabTypeID=[3,6,4]\nconst dropTypeID=[0,2,3,4]\nclass App extends React.Component {\n  constructor(props){\n    super(props);\n    let searchA=getsearch(this.props.location);\n    this.scollNum=0;\n    this.state={\n      menuTop:338,\n      isAlpha:false,\n      dataSource:[],\n      tabActive:searchA['cid']?this.getTabIndex(searchA['cid']):0,\n      dropActive:searchA['num']?this.getDropIndex(searchA['num']):0,\n      loading:false,\n    }\n    this.changeAlpha=false;\n    this.lock=false;\n    this.loading=false;\n    console.log(this.state);\n  }\n  getTabIndex(cid){\n    cid=parseInt(cid,10);\n   for (let index = 0; index < tabTypeID.length; index++) {\n     const element = tabTypeID[index];\n     if(element===cid) { return index;}\n   }\n   return 0;\n  }\n  getDropIndex(num){\n    for (let index = 0; index < dropTypeID.length; index++) {\n      const element = dropTypeID[index];\n      if(element===num) { return index;}\n    }\n    return 0;\n  }\n  componentWillUnmount(){\n    this.lock=true;\n  }\n  componentDidMount() {\n     this.positionInit();\n     this.netListdata();\n   }\n\n  positionInit(){\n    let topV=ReactDOM.findDOMNode(this.rightBtn).offsetTop;\n    topV=topV+58;\n    this.setState({menuTop:topV});\n  }\n  loadingEnd(){\n    this.loading=false;\n    if(!this.lock)this.setState({loading:false});\n  }\n  loadingStart(){\n    this.loading=true;\n    this.setState({loading:true});\n  }\n  netListdata(cid,num){\n    /*\n    cid 3 美妆 4 日用品 6 美食 \n    num 0 全部 2\b 两个组合\n    */\n   let req=\"?cid=\"+(cid?cid:tabTypeID[this.state.tabActive])+\"&num=\"+(num?num:dropTypeID[this.state.dropActive]);\n   let thisUrl=api.index_list+req;\n    if(this.loading)return;\n    this.loadingStart();\n    get(thisUrl,(res)=>{\n      this.loadingEnd();\n      //console.log(res);\n      if(res&&res['result']==='success'){\n        this.setState({dataSource:res['data']});\n      }else{\n        if(res&&res['message'])Toast.fail(res['message'], 1);\n      }\n    },(erro)=>{\n      this.loadingEnd();\n      console.log(erro);\n    });\n  }\n  rowData=(data)=>{\n    return (<div>\n     {this.state.loading?<div style={{width:\"28vw\",margin:\"auto\"}}><ActivityIndicator text=\"正在加载...\" color=\"white\"/></div>:null}\n     {data.map((item,index)=>{\n       switch(item.goods_list.length){\n         case 2:\n           return <TwoItem itemData={item} key={index} fixMain={true}/>;\n           //break;\n        case 3:\n            return <ThreeItem itemData={item} key={index} fixMain={true}/>;\n            //break;\n        case 4:\n            return <FourItem itemData={item} key={index} fixMain={true}/>;\n          //break;\n        default:\n            return <div key={index}>erro</div>;\n       }\n     })}\n    </div>);\n  }\n  tabClick=(index)=>{\n    if(index!==this.state.tabActive){\n      this.setState({tabActive:index});\n      this.netListdata(tabTypeID[index]);\n    }\n  }\n  dropFun=(index)=>{\n    if(index!==this.state.dropActive){\n      this.setState({dropActive:index});\n      this.netListdata(null,dropTypeID[index]);\n    }\n  }\n   onScrollEvent=()=>{\n    this.scollNum++;\n    let thisNum=parseInt(this.scollNum,10);\n      if(!this.state.isAlpha&&!this.changeAlpha&&!this.lock){\n        this.setState({isAlpha:true});\n        this.changeAlpha=true;\n      }\n    setTimeout(()=>{this.changeAlpha=false;},300);\n    setTimeout(()=>{  \n      if(thisNum===this.scollNum){\n        if(this.state.isAlpha)this.setState({isAlpha:false});\n        }\n     },500);\n    }\n    render() {\n      const { history,location }=this.props;\n      const pageProps={history,location};\n      \n        return(\n          <div className=\"App\" onScrollCapture={() => this.onScrollEvent()}>\n            <BackBar {...pageProps}/>\n            <DetailTop {...pageProps}/>\n            <br/>\n            <TabsTop activeid={this.state.tabActive} {...pageProps} tabClick={this.tabClick}/>\n            <DropMenu {...pageProps} fixTop={this.state.menuTop} ref={leftB=>{this.rightBtn=leftB}} isAlpha={this.state.isAlpha} dropActive={this.state.dropActive} dropFun={this.dropFun}/>\n            {this.state.dataSource&&this.state.dataSource.length>0?this.rowData(this.state.dataSource):<EmptyList/>}\n          </div>\n        );\n    }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}